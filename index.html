<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<title>OMLLA COIN</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;user-select:none}
:root{--gold:#e8a020;--gold2:#f5c842;--bg:#0e0e12;--bg2:#16161d;--bg3:#1e1e28;--card:#1a1a24;--card2:#22222e;--border:rgba(255,255,255,0.07);--text:#fff;--sub:#6b6b7e;--green:#3dd68c;--red:#f04438}
html,body{height:100%;overflow:hidden;background:var(--bg);color:var(--text);font-family:'Inter',sans-serif}
body{display:flex;flex-direction:column;position:relative}

/* BG GLOW */
.bg-glow{position:fixed;top:-30%;left:50%;transform:translateX(-50%);width:600px;height:400px;background:radial-gradient(ellipse,rgba(232,160,32,0.07) 0%,transparent 70%);pointer-events:none;z-index:0}

/* HEADER */
.header{padding:16px 18px 12px;position:relative;z-index:10;flex-shrink:0}
.header-row1{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
.user-pill{display:flex;align-items:center;gap:8px;background:var(â€“card2);border:1px solid var(â€“border);border-radius:30px;padding:6px 14px 6px 6px}
.avatar{width:30px;height:30px;border-radius:50%;background:linear-gradient(135deg,var(â€“gold),#c47a10);display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:800;color:#000}
.uname{font-size:13px;font-weight:600;color:#ccc}
.lvl-pill{background:var(â€“card2);border:1px solid var(â€“border);border-radius:30px;padding:7px 14px;font-size:12px;font-weight:700;color:var(â€“gold);display:flex;align-items:center;gap:5px}
.lvl-pill::before{content:â€˜â­â€™;font-size:12px}

.balance-block{text-align:center}
.bal-row{display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:4px}
.bal-icon{width:34px;height:34px;border-radius:50%;background:linear-gradient(135deg,var(â€“gold2),var(â€“gold));display:flex;align-items:center;justify-content:center;font-size:18px;box-shadow:0 4px 20px rgba(232,160,32,0.4)}
.bal-amount{font-size:38px;font-weight:900;color:#fff;letter-spacing:-1px}
.bal-sub{font-size:12px;color:var(â€“sub);font-weight:500}

/* PAGES */
.page{display:none;flex:1;overflow-y:auto;padding:10px 16px 100px;position:relative;z-index:5}
.page.active{display:block}
.page::-webkit-scrollbar{width:0}

/* COIN AREA */
.coin-area{display:flex;flex-direction:column;align-items:center;padding:8px 0 4px}

.coin-wrap{position:relative;width:240px;height:240px;margin-bottom:16px}
.coin-shadow{position:absolute;bottom:-20px;left:50%;transform:translateX(-50%);width:180px;height:24px;background:radial-gradient(ellipse,rgba(232,160,32,0.4) 0%,transparent 70%);border-radius:50%;filter:blur(8px)}
.coin-ring1{position:absolute;inset:-8px;border-radius:50%;background:conic-gradient(from 0deg,transparent 0%,rgba(232,160,32,0.6) 25%,transparent 50%,rgba(245,200,66,0.6) 75%,transparent 100%);animation:spinRing 3s linear infinite}
.coin-ring2{position:absolute;inset:-4px;border-radius:50%;background:conic-gradient(from 180deg,transparent 0%,rgba(232,160,32,0.3) 25%,transparent 50%,rgba(245,200,66,0.3) 75%,transparent 100%);animation:spinRing 2s linear infinite reverse}
@keyframes spinRing{to{transform:rotate(360deg)}}
.coin-main{position:absolute;inset:0;border-radius:50%;background:radial-gradient(circle at 32% 28%,#ffe066 0%,#f5a020 35%,#c47a10 65%,#7a4a00 100%);display:flex;align-items:center;justify-content:center;cursor:pointer;overflow:hidden;box-shadow:0 0 40px rgba(232,160,32,0.3),inset 0 2px 0 rgba(255,255,255,0.2),inset 0 -4px 0 rgba(0,0,0,0.3);transition:transform 0.06s,box-shadow 0.06s}
.coin-main::before{content:â€™â€™;position:absolute;top:8%;left:12%;width:38%;height:32%;background:radial-gradient(ellipse,rgba(255,255,255,0.5) 0%,transparent 70%);border-radius:50%;transform:rotate(-20deg)}
.coin-main:active{transform:scale(0.87);box-shadow:0 0 20px rgba(232,160,32,0.2),inset 0 2px 0 rgba(255,255,255,0.1)}
.coin-emoji{font-size:85px;filter:drop-shadow(0 4px 8px rgba(0,0,0,0.5));z-index:1;line-height:1}

.tap-float{position:fixed;font-size:28px;font-weight:900;color:#fff;pointer-events:none;z-index:9999;animation:tapAnim 0.7s ease-out forwards}
@keyframes tapAnim{0%{opacity:1;transform:translateY(0) scale(1.3)}100%{opacity:0;transform:translateY(-90px) scale(0.7)}}

/* ENERGY */
.energy-bar-wrap{width:100%;background:var(â€“card);border:1px solid var(â€“border);border-radius:14px;padding:12px 14px;margin-bottom:10px}
.ebar-top{display:flex;justify-content:space-between;margin-bottom:8px}
.ebar-label{font-size:13px;font-weight:700;color:#fff;display:flex;align-items:center;gap:5px}
.ebar-label::before{content:â€˜âš¡â€™;font-size:13px}
.ebar-val{font-size:13px;font-weight:600;color:var(â€“sub)}
.ebar-track{width:100%;height:8px;background:rgba(255,255,255,0.06);border-radius:6px;overflow:hidden}
.ebar-fill{height:100%;background:linear-gradient(90deg,#f5a020,#f5c842);border-radius:6px;transition:width 0.3s ease;position:relative}
.ebar-fill::after{content:â€™â€™;position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.4),transparent);animation:shine 2s infinite}
@keyframes shine{to{left:100%}}

/* XP BAR */
.xp-bar-wrap{width:100%;background:var(â€“card);border:1px solid var(â€“border);border-radius:14px;padding:12px 14px;margin-bottom:10px}
.xp-track{width:100%;height:6px;background:rgba(255,255,255,0.06);border-radius:6px;overflow:hidden;margin-top:8px}
.xp-fill{height:100%;background:linear-gradient(90deg,#7c3aed,#a855f7,#f5a020);border-radius:6px;transition:width 0.4s ease}

/* SECTION */
.sec-title{font-size:15px;font-weight:800;color:#fff;margin:14px 0 10px;letter-spacing:-0.3px}

/* CARDS */
.card{background:var(â€“card);border:1px solid var(â€“border);border-radius:18px;padding:14px;margin-bottom:10px;display:flex;align-items:center;justify-content:space-between;transition:border-color 0.2s}
.card:active{border-color:rgba(232,160,32,0.3);background:var(â€“card2)}
.card-left{display:flex;align-items:center;gap:12px}
.card-icon{width:44px;height:44px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0}
.card-icon.gold{background:rgba(232,160,32,0.12)}
.card-icon.green{background:rgba(61,214,140,0.1)}
.card-icon.purple{background:rgba(168,85,247,0.1)}
.card-icon.blue{background:rgba(59,130,246,0.1)}
.card-title{font-size:14px;font-weight:700;margin-bottom:3px}
.card-sub{font-size:12px;color:var(â€“sub);font-weight:500}
.card-cost{font-size:12px;color:var(â€“gold);font-weight:700;margin-top:3px}

/* BUTTONS */
.btn{background:linear-gradient(135deg,#f5a020,#c47a10);color:#000;border:none;border-radius:12px;padding:10px 18px;font-size:13px;font-weight:800;cursor:pointer;font-family:â€˜Interâ€™,sans-serif;transition:transform 0.1s,opacity 0.1s;flex-shrink:0}
.btn:active{transform:scale(0.92)}
.btn:disabled{background:var(â€“card2);color:var(â€“sub);cursor:default}
.btn.done{background:rgba(61,214,140,0.1);color:var(â€“green);border:1px solid rgba(61,214,140,0.3)}
.btn-full{width:100%;padding:15px;font-size:15px;border-radius:14px;margin-top:8px;text-align:center}

/* DAILY STREAK */
.streak-card{background:var(â€“card);border:1px solid var(â€“border);border-radius:18px;padding:16px;margin-bottom:10px}
.streak-days{display:flex;gap:6px;justify-content:center;margin:12px 0;flex-wrap:wrap}
.sday{width:38px;height:46px;border-radius:10px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.07);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px}
.sday .d-num{font-size:11px;font-weight:700;color:var(â€“sub)}
.sday .d-amt{font-size:8px;color:var(â€“sub)}
.sday.done{background:linear-gradient(135deg,rgba(232,160,32,0.2),rgba(196,122,16,0.2));border-color:rgba(232,160,32,0.4)}
.sday.done .d-num,.sday.done .d-amt{color:var(â€“gold)}
.sday.today{border-color:var(â€“gold);background:rgba(232,160,32,0.08)}
.sday.today .d-num,.sday.today .d-amt{color:var(â€“gold)}

/* LEADERBOARD */
.lb-card{background:var(â€“card);border:1px solid var(â€“border);border-radius:16px;padding:13px 14px;display:flex;align-items:center;gap:12px;margin-bottom:8px}
.lb-card.me{border-color:rgba(232,160,32,0.35);background:rgba(232,160,32,0.05)}
.rank-num{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:800;flex-shrink:0}
.rk1{background:linear-gradient(135deg,#ffd700,#ffa500);color:#000}
.rk2{background:linear-gradient(135deg,#c0c0c0,#888);color:#000}
.rk3{background:linear-gradient(135deg,#cd7f32,#8b4513);color:#fff}
.rko{background:rgba(255,255,255,0.07);color:var(â€“sub);font-size:11px}
.lb-info{flex:1}
.lb-name{font-size:14px;font-weight:700}
.lb-bal{font-size:12px;color:var(â€“gold);font-weight:600;margin-top:2px}

/* WALLET */
.wallet-hero{background:var(â€“card);border:1px solid var(â€“border);border-radius:20px;padding:24px;text-align:center;margin-bottom:12px}
.wallet-emoji{font-size:52px;margin-bottom:14px;display:block}
.wallet-title{font-size:17px;font-weight:800;margin-bottom:8px}
.wallet-desc{font-size:13px;color:var(â€“sub);line-height:1.6;margin-bottom:16px}
.wallet-connected{background:rgba(61,214,140,0.08);border:1px solid rgba(61,214,140,0.25);border-radius:12px;padding:10px;font-size:11px;color:var(â€“green);word-break:break-all;margin-bottom:10px;display:none}
.wallet-input{width:100%;background:rgba(255,255,255,0.05);border:1px solid var(â€“border);border-radius:12px;padding:13px;color:#fff;font-size:13px;font-weight:500;outline:none;text-align:center;font-family:â€˜Interâ€™,sans-serif;margin-bottom:10px;transition:border-color 0.2s}
.wallet-input:focus{border-color:rgba(232,160,32,0.5)}
.wallet-input::placeholder{color:var(â€“sub)}

/* STAT GRID */
.stat-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
.stat-box{background:var(â€“card2);border-radius:14px;padding:14px;text-align:center;border:1px solid var(â€“border)}
.stat-val{font-size:20px;font-weight:900;letter-spacing:-0.5px}
.stat-lbl{font-size:11px;color:var(â€“sub);margin-top:4px;font-weight:500}

/* REF BOX */
.ref-box{background:rgba(232,160,32,0.06);border:1px dashed rgba(232,160,32,0.3);border-radius:14px;padding:14px;text-align:center;margin:10px 0;display:none}
.ref-link{font-size:11px;color:var(â€“gold);word-break:break-all;margin:6px 0 10px;font-weight:600;line-height:1.5}
.ref-copy-btn{background:rgba(232,160,32,0.12);border:1px solid rgba(232,160,32,0.3);color:var(â€“gold);padding:9px 18px;border-radius:10px;font-size:13px;font-weight:700;cursor:pointer;font-family:â€˜Interâ€™,sans-serif}

/* TOAST */
.toast{position:fixed;top:70px;left:50%;transform:translateX(-50%) translateY(-12px);background:rgba(22,22,29,0.97);border:1px solid rgba(255,255,255,0.1);color:#fff;padding:11px 20px;border-radius:30px;font-size:13px;font-weight:600;z-index:9999;opacity:0;transition:all 0.25s;white-space:nowrap;pointer-events:none;backdrop-filter:blur(10px)}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0)}

/* NAV */
.nav{position:fixed;bottom:0;left:0;width:100%;z-index:1000;flex-shrink:0}
.nav-bg{background:rgba(14,14,18,0.95);backdrop-filter:blur(20px);border-top:1px solid var(â€“border);padding:8px 4px 22px;display:flex;justify-content:space-around}
.nav-item{flex:1;display:flex;flex-direction:column;align-items:center;gap:4px;color:var(â€“sub);font-size:10px;font-weight:600;cursor:pointer;padding:4px 0;border-radius:10px;transition:color 0.2s}
.nav-item.active{color:var(â€“gold)}
.nav-item.active .nav-icon-wrap{background:rgba(232,160,32,0.12)}
.nav-icon-wrap{width:40px;height:32px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;transition:background 0.2s}
</style>

</head>
<body>
<div class="bg-glow"></div>
<div class="toast" id="toast"></div>

<!-- HEADER -->

<header class="header">
  <div class="header-row1">
    <div class="user-pill">
      <div class="avatar" id="usr-init">O</div>
      <span class="uname" id="usr-name">Player</span>
    </div>
    <div class="lvl-pill" id="lvl-badge">LVL 1</div>
  </div>
  <div class="balance-block">
    <div class="bal-row">
      <div class="bal-icon">ğŸ¢</div>
      <div class="bal-amount" id="bal">0</div>
    </div>
    <div class="bal-sub">OMLLA Coins</div>
  </div>
</header>

<!-- MINE -->

<main id="page-mine" class="page active">
  <div class="coin-area">
    <div class="coin-wrap" id="coin-tap">
      <div class="coin-ring1"></div>
      <div class="coin-ring2"></div>
      <div class="coin-main">
        <div class="coin-emoji">ğŸ¢</div>
      </div>
      <div class="coin-shadow"></div>
    </div>
  </div>
  <div class="energy-bar-wrap">
    <div class="ebar-top">
      <span class="ebar-label">Energy</span>
      <span class="ebar-val" id="ebar-val">1000 / 1000</span>
    </div>
    <div class="ebar-track"><div class="ebar-fill" id="ebar-fill" style="width:100%"></div></div>
  </div>
  <div class="xp-bar-wrap">
    <div class="ebar-top">
      <span class="ebar-label" style="color:#a855f7">â˜… &nbsp;Level Progress</span>
      <span class="ebar-val" id="xp-val">0%</span>
    </div>
    <div class="xp-track"><div class="xp-fill" id="xp-fill" style="width:0%"></div></div>
  </div>
</main>

<!-- BOOST -->

<main id="page-boost" class="page">
  <div class="sec-title">âš¡ Boosters</div>
  <div class="card">
    <div class="card-left">
      <div class="card-icon gold">ğŸ‘†</div>
      <div>
        <div class="card-title">Multi-Tap</div>
        <div class="card-sub">+<span id="tap-pow">1</span> coin per tap</div>
        <div class="card-cost" id="tap-cost">Cost: 2,000</div>
      </div>
    </div>
    <button class="btn" onclick="upgrade('tap')">Upgrade</button>
  </div>
  <div class="card">
    <div class="card-left">
      <div class="card-icon green">âš¡</div>
      <div>
        <div class="card-title">Energy Limit</div>
        <div class="card-sub">+500 Max Energy</div>
        <div class="card-cost" id="en-cost">Cost: 5,000</div>
      </div>
    </div>
    <button class="btn" onclick="upgrade('energy')">Upgrade</button>
  </div>
  <div class="card">
    <div class="card-left">
      <div class="card-icon purple">ğŸ”‹</div>
      <div>
        <div class="card-title">Turbo Regen</div>
        <div class="card-sub">+2 Energy/sec</div>
        <div class="card-cost" id="rg-cost">Cost: 8,000</div>
      </div>
    </div>
    <button class="btn" onclick="upgrade('regen')">Upgrade</button>
  </div>
  <div class="sec-title">ğŸ†“ Free Daily</div>
  <div class="card">
    <div class="card-left">
      <div class="card-icon gold">âš¡</div>
      <div>
        <div class="card-title">Full Energy Refill</div>
        <div class="card-sub" id="refill-left">3 uses remaining today</div>
      </div>
    </div>
    <button class="btn" id="refill-btn" onclick="refillEnergy()">Use</button>
  </div>
</main>

<!-- EARN -->

<main id="page-earn" class="page">
  <div class="streak-card">
    <div class="sec-title" style="margin:0 0 0">ğŸ“… Daily Streak</div>
    <div class="streak-days" id="streak-days"></div>
    <button class="btn btn-full" id="daily-btn" onclick="claimDaily()">ğŸ Claim Daily Reward</button>
  </div>
  <div class="sec-title">âœ… Tasks</div>
  <div class="card">
    <div class="card-left">
      <div class="card-icon blue">ğŸ’¬</div>
      <div>
        <div class="card-title">Join Community</div>
        <div class="card-sub" style="color:var(--green)">+5,000 Coins</div>
      </div>
    </div>
    <button class="btn" id="join-btn" onclick="joinComm()">Join</button>
  </div>
  <div class="card">
    <div class="card-left">
      <div class="card-icon green">ğŸ‘¥</div>
      <div>
        <div class="card-title">Invite Friends</div>
        <div class="card-sub" style="color:var(--green)">+25,000 / Friend</div>
      </div>
    </div>
    <button class="btn" onclick="showRef()">Invite</button>
  </div>
  <div class="ref-box" id="ref-box">
    <div style="font-size:11px;color:var(--sub);margin-bottom:4px">Your Referral Link</div>
    <div class="ref-link" id="ref-link"></div>
    <button class="ref-copy-btn" onclick="copyRef()">ğŸ“‹ Copy & Share</button>
  </div>
  <div class="card">
    <div class="card-left">
      <div class="card-icon" style="background:rgba(239,68,68,0.1)">ğŸ“º</div>
      <div>
        <div class="card-title">Watch & Earn</div>
        <div class="card-sub" style="color:var(--green)">+500 Coins</div>
      </div>
    </div>
    <button class="btn" onclick="toast('ğŸ“º Coming soon!')">Watch</button>
  </div>
</main>

<!-- LEADERBOARD -->

<main id="page-leaderboard" class="page">
  <div class="sec-title">ğŸ† Top Players</div>
  <div id="lb-list"><div style="text-align:center;color:var(--sub);padding:50px 0">Loading...</div></div>
</main>

<!-- WALLET -->

<main id="page-wallet" class="page">
  <div class="sec-title">ğŸ’¼ Airdrop Wallet</div>
  <div class="wallet-hero">
    <span class="wallet-emoji">ğŸŒŸ</span>
    <div class="wallet-title">Connect Solana Wallet</div>
    <div class="wallet-desc">Link your wallet to receive the OMLLA token airdrop in Q4 2026. The more you earn now, the more tokens you'll receive!</div>
    <div class="wallet-connected" id="w-connected"></div>
    <input type="text" class="wallet-input" id="w-input" placeholder="Your Solana wallet address...">
    <button class="btn btn-full" onclick="saveWallet()">ğŸ”— Connect Wallet</button>
  </div>
  <div class="sec-title">ğŸ“Š Your Stats</div>
  <div class="stat-grid">
    <div class="stat-box">
      <div class="stat-val" id="st-coins" style="color:var(--gold)">0</div>
      <div class="stat-lbl">Total Coins</div>
    </div>
    <div class="stat-box">
      <div class="stat-val" id="st-refs" style="color:var(--green)">0</div>
      <div class="stat-lbl">Referrals</div>
    </div>
  </div>
</main>

<!-- NAV -->

<nav class="nav">
  <div class="nav-bg">
    <div class="nav-item active" onclick="go('mine',this)">
      <div class="nav-icon-wrap">â›ï¸</div>Mine
    </div>
    <div class="nav-item" onclick="go('boost',this)">
      <div class="nav-icon-wrap">ğŸš€</div>Boost
    </div>
    <div class="nav-item" onclick="go('earn',this)">
      <div class="nav-icon-wrap">ğŸª™</div>Earn
    </div>
    <div class="nav-item" onclick="go('leaderboard',this)">
      <div class="nav-icon-wrap">ğŸ†</div>Top
    </div>
    <div class="nav-item" onclick="go('wallet',this)">
      <div class="nav-icon-wrap">ğŸ’¼</div>Wallet
    </div>
  </div>
</nav>

<script>
// TG
const tg=window.Telegram?.WebApp||{expand:()=>{},ready:()=>{},initDataUnsafe:{},HapticFeedback:{impactOccurred:()=>{},notificationOccurred:()=>{}},openLink:u=>window.open(u,'_blank'),openTelegramLink:u=>window.open(u,'_blank')};
try{tg.expand();tg.ready();}catch(e){}
const tgU=tg.initDataUnsafe?.user;
const UID=tgU?.id?.toString()||'demo';
const UNAME=tgU?.first_name||'Player';
document.getElementById('usr-name').textContent=UNAME;
document.getElementById('usr-init').textContent=UNAME[0].toUpperCase();

// STATE
const KEY='omlla_v4_'+UID;
const DEF={bal:0,en:1000,maxEn:1000,tapPow:1,tapCost:2000,enCost:5000,rgCost:8000,rgBonus:0,lastDaily:0,streak:0,refillCount:0,refillDay:'',refs:0,joined:false,wallet:'',total:0};
let s={...DEF};
try{const sv=localStorage.getItem(KEY);if(sv)s={...DEF,...JSON.parse(sv)};}catch(e){}
const save=()=>{try{localStorage.setItem(KEY,JSON.stringify(s));}catch(e){}};

// CLICK
const coinEl=document.getElementById('coin-tap');
coinEl.addEventListener('touchstart',e=>{
  e.preventDefault();
  if(s.en<s.tapPow){toast('âš¡ No energy!');return;}
  s.bal+=s.tapPow;s.en=Math.max(0,s.en-s.tapPow);s.total=(s.total||0)+s.tapPow;
  for(let i=0;i<e.changedTouches.length;i++)spawnFloat(e.changedTouches[i].clientX,e.changedTouches[i].clientY);
  try{tg.HapticFeedback.impactOccurred('medium');}catch(e){}
  ui();save();
},{passive:false});
coinEl.addEventListener('click',e=>{
  if(s.en<s.tapPow){toast('âš¡ No energy!');return;}
  s.bal+=s.tapPow;s.en=Math.max(0,s.en-s.tapPow);s.total=(s.total||0)+s.tapPow;
  spawnFloat(e.clientX,e.clientY);ui();save();
});

function spawnFloat(x,y){
  const el=document.createElement('div');
  el.className='tap-float';
  el.textContent='+'+s.tapPow;
  el.style.cssText=`left:${x-16}px;top:${y-40}px;font-family:Inter,sans-serif`;
  document.body.appendChild(el);
  setTimeout(()=>el.remove(),700);
}

// REGEN
setInterval(()=>{if(s.en<s.maxEn){s.en=Math.min(s.en+3+s.rgBonus,s.maxEn);ui();}},1000);
setInterval(save,5000);

// UPGRADES
function upgrade(t){
  if(t==='tap'){
    if(s.bal<s.tapCost){toast('âŒ Not enough coins!');return;}
    s.bal-=s.tapCost;s.tapPow++;s.tapCost=Math.floor(s.tapCost*2.5);toast('âœ… Multi-Tap upgraded!');
  }else if(t==='energy'){
    if(s.bal<s.enCost){toast('âŒ Not enough coins!');return;}
    s.bal-=s.enCost;s.maxEn+=500;s.enCost=Math.floor(s.enCost*2);toast('âœ… Energy limit +500!');
  }else if(t==='regen'){
    if(s.bal<s.rgCost){toast('âŒ Not enough coins!');return;}
    s.bal-=s.rgCost;s.rgBonus+=2;s.rgCost=Math.floor(s.rgCost*2.2);toast('âœ… Turbo Regen upgraded!');
  }
  try{tg.HapticFeedback.notificationOccurred('success');}catch(e){}
  ui();save();
}

function refillEnergy(){
  const today=new Date().toDateString();
  if(s.refillDay!==today){s.refillCount=0;s.refillDay=today;}
  if(s.refillCount>=3){toast('âŒ Max 3 refills/day!');return;}
  s.en=s.maxEn;s.refillCount++;toast('âš¡ Energy refilled!');ui();save();
}

// DAILY
const REWARDS=[1000,2500,5000,8000,12000,18000,25000];
function claimDaily(){
  const now=Date.now(),diff=now-(s.lastDaily||0);
  if(diff<86400000){
    const h=Math.floor((86400000-diff)/3600000),m=Math.floor(((86400000-diff)%3600000)/60000);
    toast('â³ '+h+'h '+m+'m remaining');return;
  }
  if(diff>172800000)s.streak=0;
  const r=REWARDS[Math.min(s.streak||0,REWARDS.length-1)];
  s.bal+=r;s.total=(s.total||0)+r;s.lastDaily=now;s.streak=(s.streak||0)+1;
  try{tg.HapticFeedback.notificationOccurred('success');}catch(e){}
  toast('ğŸ +'+r.toLocaleString()+' â€” Day '+s.streak+' streak!');
  buildStreak();ui();save();
}

function buildStreak(){
  const c=document.getElementById('streak-days');c.innerHTML='';
  const streak=s.streak||0;
  REWARDS.forEach((r,i)=>{
    const d=document.createElement('div');d.className='sday';
    if(i<streak)d.classList.add('done');
    else if(i===streak)d.classList.add('today');
    d.innerHTML='<span class="d-num">'+(i+1)+'</span><span class="d-amt">'+(r>=1000?Math.floor(r/1000)+'K':r)+'</span>';
    c.appendChild(d);
  });
  const btn=document.getElementById('daily-btn');
  const can=!s.lastDaily||(Date.now()-s.lastDaily)>=86400000;
  btn.disabled=!can;
  btn.textContent=can?'ğŸ Claim Daily Reward':'âœ… Claimed Today';
  if(!can)btn.classList.add('done');else btn.classList.remove('done');
}

// COMMUNITY
function joinComm(){
  if(!s.joined){
    s.bal+=5000;s.total=(s.total||0)+5000;s.joined=true;
    toast('âœ… +5,000 Coins!');ui();save();
    const b=document.getElementById('join-btn');b.textContent='âœ… Done';b.disabled=true;b.classList.add('done');
  }
  try{tg.openLink('https://t.me/omllacapital');}catch(e){window.open('https://t.me/omllacapital','_blank');}
}

function showRef(){
  const box=document.getElementById('ref-box');
  const link='https://t.me/Omlla_Robot?start=ref_'+UID;
  document.getElementById('ref-link').textContent=link;
  box.style.display=box.style.display==='block'?'none':'block';
}

function copyRef(){
  const link='https://t.me/Omlla_Robot?start=ref_'+UID;
  try{navigator.clipboard.writeText(link).then(()=>toast('ğŸ“‹ Copied!'));}catch(e){toast('ğŸ“‹ Copy: '+link);}
  try{tg.openTelegramLink('https://t.me/share/url?url='+encodeURIComponent(link)+'&text='+encodeURIComponent('ğŸ¢ Play OMLLA COIN and earn crypto tokens!'));}catch(e){}
}

// LEADERBOARD
function loadLB(){
  const me={name:UNAME,bal:s.bal,id:UID};
  const demo=[
    {name:'ArabicKing',bal:1240000,id:'a1'},
    {name:'CryptoWolf',bal:890000,id:'a2'},
    {name:'TonHunter',bal:640000,id:'a3'},
    {name:'OmllaPro',bal:390000,id:'a4'},
    {name:'TurtleFast',bal:210000,id:'a5'},
    {name:'Web3Master',bal:140000,id:'a6'},
  ];
  let list=[...demo,me].sort((a,b)=>b.bal-a.bal);
  const c=document.getElementById('lb-list');c.innerHTML='';
  list.forEach((p,i)=>{
    const isMe=p.id===UID;
    const rc=i===0?'rk1':i===1?'rk2':i===2?'rk3':'rko';
    const medals=['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];
    const d=document.createElement('div');d.className='lb-card'+(isMe?' me':'');
    d.innerHTML=`<div class="rank-num ${rc}">${i<3?medals[i]:i+1}</div><div class="lb-info"><div class="lb-name">${p.name}${isMe?' ğŸ‘ˆ':''}</div><div class="lb-bal">ğŸª™ ${Math.floor(p.bal).toLocaleString()}</div></div>`;
    c.appendChild(d);
  });
}

// WALLET
function saveWallet(){
  const addr=document.getElementById('w-input').value.trim();
  if(addr.length<32){toast('âŒ Invalid Solana address');return;}
  s.wallet=addr;save();toast('âœ… Wallet connected!');showWallet();
}
function showWallet(){
  if(s.wallet){
    const el=document.getElementById('w-connected');
    el.style.display='block';el.textContent='âœ… '+s.wallet;
    document.getElementById('w-input').value=s.wallet;
  }
}

// UI
function ui(){
  document.getElementById('bal').textContent=Math.floor(s.bal).toLocaleString();
  document.getElementById('ebar-val').textContent=Math.floor(s.en)+' / '+s.maxEn;
  document.getElementById('ebar-fill').style.width=(s.en/s.maxEn*100)+'%';
  const lv=Math.floor(Math.pow(Math.max(s.bal,0)/1000,0.5))+1;
  document.getElementById('lvl-badge').textContent='â­ LVL '+lv;
  const cur=Math.pow(lv-1,2)*1000,nxt=Math.pow(lv,2)*1000;
  const pct=Math.min(Math.max((s.bal-cur)/(nxt-cur)*100,0),100);
  document.getElementById('xp-fill').style.width=pct+'%';
  document.getElementById('xp-val').textContent=Math.floor(pct)+'%';
  document.getElementById('tap-pow').textContent=s.tapPow;
  document.getElementById('tap-cost').textContent='Cost: '+s.tapCost.toLocaleString();
  document.getElementById('en-cost').textContent='Cost: '+s.enCost.toLocaleString();
  document.getElementById('rg-cost').textContent='Cost: '+s.rgCost.toLocaleString();
  const today=new Date().toDateString();
  if(s.refillDay!==today)s.refillCount=0;
  const left=Math.max(0,3-(s.refillCount||0));
  document.getElementById('refill-left').textContent=left+' uses remaining today';
  document.getElementById('st-coins').textContent=Math.floor(s.total||s.bal).toLocaleString();
  document.getElementById('st-refs').textContent=s.refs||0;
  if(s.joined){const b=document.getElementById('join-btn');b.textContent='âœ… Done';b.disabled=true;b.classList.add('done');}
}

// TAB
function go(id,el){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById('page-'+id).classList.add('active');
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  el.classList.add('active');
  try{tg.HapticFeedback.impactOccurred('light');}catch(e){}
  if(id==='leaderboard')loadLB();
  if(id==='earn')buildStreak();
}

// TOAST
function toast(msg){
  const t=document.getElementById('toast');
  t.textContent=msg;t.classList.add('show');
  clearTimeout(t._t);t._t=setTimeout(()=>t.classList.remove('show'),2500);
}

// INIT
ui();buildStreak();loadLB();showWallet();
</script>

</body>
</html>