<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>OMLLA GAME | OFFICIAL PRESTIGE</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
        :root {
            --primary: #14F195;
            --primary-glow: rgba(20, 241, 149, 0.4);
            --dark: #050505;
            --dark-light: #0f0f0f;
            --gray: #222;
            --text-gray: #888;
        }

        body {
            background: var(--dark);
            color: white;
            font-family: 'Inter', -apple-system, sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 450px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* Branding */
        .brand-header { text-align: center; margin-top: 10px; }
        .brand-text { font-size: 10px; letter-spacing: 5px; color: var(--text-gray); font-weight: 800; }

        /* Balance Card */
        .balance-card {
            background: linear-gradient(145deg, var(--dark-light), #050505);
            border-radius: 25px;
            padding: 25px;
            border: 1px solid var(--gray);
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .balance-amount {
            font-size: 58px;
            font-weight: 900;
            color: var(--primary);
            text-shadow: 0 0 20px var(--primary-glow);
        }
        .balance-label { font-size: 12px; color: var(--text-gray); text-transform: uppercase; letter-spacing: 2px; }

        /* User Identity Bar */
        .identity-bar {
            background: var(--dark-light);
            border-radius: 50px;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            gap: 12px;
            border: 1px solid var(--gray);
        }
        .avatar-circle {
            width: 35px; height: 35px;
            background: var(--primary);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            color: black; font-weight: bold;
        }
        .user-meta { flex: 1; }
        .user-nickname { font-size: 14px; font-weight: 700; }
        .user-rank { font-size: 10px; color: var(--primary); font-weight: 800; text-transform: uppercase; }

        /* Tap Engine */
        .tap-sector {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px 0;
        }
        .omlla-coin {
            width: 260px; height: 260px;
            background: url('https://i.postimg.cc/85zZJk3G/omlla-coin-final.png') center/cover; /* Replace with your hosted icon link */
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.05s;
            box-shadow: 0 0 60px var(--primary-glow);
            display: flex; justify-content: center; align-items: center;
        }
        .omlla-coin:active { transform: scale(0.94); }
        .coin-fallback { font-size: 80px; font-weight: 900; color: var(--primary); }

        /* Referral System */
        .invite-box {
            background: rgba(20, 241, 149, 0.03);
            border: 1px solid var(--primary);
            border-radius: 20px;
            padding: 15px;
            text-align: center;
        }
        .invite-btn {
            background: var(--primary);
            color: black;
            border: none;
            padding: 12px;
            width: 100%;
            border-radius: 15px;
            font-weight: 900;
            margin-top: 10px;
            cursor: pointer;
        }

        /* Energy & Stamina */
        .stamina-container {
            background: var(--dark-light);
            padding: 15px;
            border-radius: 20px;
            border: 1px solid var(--gray);
        }
        .stamina-header { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 8px; }
        .progress-track { height: 8px; background: var(--gray); border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--primary); width: 100%; transition: 0.3s; }

        /* Status Toast */
        .toast {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: var(--primary); color: black; padding: 10px 20px;
            border-radius: 50px; font-weight: bold; display: none; z-index: 1000;
        }

        /* Particles */
        .plus-one {
            position: absolute; color: var(--primary); font-weight: 900; font-size: 24px;
            pointer-events: none; animation: floatUp 0.8s forwards;
        }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-100px); } }
    </style>
</head>
<body>

    <div class="container">
        <div class="brand-header">
            <p class="brand-text">OMLLA PRESTIGE NETWORK</p>
        </div>

        <div class="balance-card">
            <p class="balance-label">Current Capital</p>
            <h1 class="balance-amount" id="balance">0</h1>
            <p style="color:var(--text-gray); font-size: 14px; font-weight: bold;">O$ COINS</p>
        </div>

        <div class="identity-bar">
            <div class="avatar-circle" id="user-avatar">?</div>
            <div class="user-meta">
                <p class="user-nickname" id="user-name">Analyzing...</p>
                <p class="user-rank" id="user-rank">Elite Member</p>
            </div>
            <div style="font-size: 10px; color: var(--text-gray);" id="user-id">ID: ---</div>
        </div>

        <div class="tap-sector">
            <div class="omlla-coin" id="tap-trigger">
                <div class="coin-fallback">O$</div>
            </div>
        </div>

        <div class="invite-box">
            <p style="font-size: 12px; color: var(--primary); font-weight: 800;">RECRUITMENT PROGRAM</p>
            <p style="font-size: 11px; color: var(--text-gray); margin-top: 5px;">Earn 100 O$ per friend & 10% commission</p>
            <button class="invite-btn" onclick="copyInviteLink()">INVITE PARTNERS</button>
        </div>

        <div class="stamina-container">
            <div class="stamina-header">
                <span>STAMINA</span>
                <span id="stamina-val">1000/1000</span>
            </div>
            <div class="progress-track">
                <div class="progress-fill" id="stamina-fill"></div>
            </div>
        </div>

        <div style="text-align: center; font-size: 10px; color: var(--text-gray); margin-top: 10px;">
            <p id="connection-status">Connecting to Secure Node...</p>
            <p>Â© 2026 OMLLA FINANCIAL GROUP</p>
        </div>
    </div>

    <div class="toast" id="toast">LINK COPIED</div>

    <script>
        (function() {
            const tg = window.Telegram.WebApp;
            tg.expand();

            // --- Firebase Config ---
            const firebaseConfig = {
                databaseURL: "https://omlla-game-default-rtdb.firebaseio.com"
            };

            // --- State ---
            let player = {
                points: 0,
                energy: 1000,
                maxEnergy: 1000,
                name: "Elite Member"
            };

            firebase.initializeApp(firebaseConfig);
            const db = firebase.database();
            const user = tg.initDataUnsafe.user || { id: 'dev_test', first_name: 'Admin' };
            const userRef = db.ref('players/' + user.id);

            // --- UI Sync ---
            function updateUI() {
                document.getElementById('balance').innerText = Math.floor(player.points).toLocaleString();
                document.getElementById('stamina-val').innerText = `${Math.floor(player.energy)}/1000`;
                document.getElementById('stamina-fill').style.width = `${(player.energy / 1000) * 100}%`;
                
                // Rank logic
                let rank = "Beginner";
                if(player.points > 5000) rank = "Bronze Merchant";
                if(player.points > 20000) rank = "Silver Broker";
                if(player.points > 100000) rank = "Gold Investor";
                document.getElementById('user-rank').innerText = rank;
            }

            // --- Init User ---
            document.getElementById('user-name').innerText = user.first_name;
            document.getElementById('user-avatar').innerText = user.first_name.charAt(0);
            document.getElementById('user-id').innerText = `ID: ${user.id}`;

            userRef.on('value', (snap) => {
                const data = snap.val();
                if(data) {
                    player.points = data.points || 0;
                    player.energy = data.energy ?? 1000;
                    player.name = data.name || user.first_name;
                    updateUI();
                } else {
                    // Create New Profile (Satisfies hasChildren Rule)
                    userRef.set({ points: 0, energy: 1000, name: user.first_name });
                }
                document.getElementById('connection-status').innerText = "NODE ONLINE: SECURE CONNECTION";
            });

            // --- Tap Logic ---
            document.getElementById('tap-trigger').addEventListener('touchstart', (e) => {
                e.preventDefault();
                if(player.energy >= 1) {
                    player.points += 1;
                    player.energy -= 1;
                    
                    // Satisfaction of Firebase rules: newData.hasChildren(['points', 'name'])
                    userRef.update({ 
                        points: player.points, 
                        energy: player.energy,
                        name: user.first_name 
                    });

                    updateUI();
                    createPlusOne(e.touches[0].clientX, e.touches[0].clientY);
                    if(tg.HapticFeedback) tg.HapticFeedback.impactOccurred('light');
                }
            });

            function createPlusOne(x, y) {
                const el = document.createElement('div');
                el.className = 'plus-one';
                el.innerText = '+1';
                el.style.left = `${x}px`;
                el.style.top = `${y}px`;
                document.body.appendChild(el);
                setTimeout(() => el.remove(), 800);
            }

            // --- Utility ---
            window.copyInviteLink = function() {
                const link = `https://t.me/OMLLA_COIN_bot?start=${user.id}`;
                navigator.clipboard.writeText(link);
                const t = document.getElementById('toast');
                t.style.display = 'block';
                setTimeout(() => t.style.display = 'none', 2000);
            };

            // Energy Regen
            setInterval(() => {
                if(player.energy < 1000) {
                    player.energy += 1;
                    updateUI();
                }
            }, 3000);

        })();
    </script>
</body>
</html>
