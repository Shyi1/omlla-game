<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Omlla Game</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { background: #000; color: #fff; font-family: sans-serif; text-align: center; margin: 0; padding: 20px; }
        .balance { font-size: 50px; font-weight: 900; color: #14F195; margin: 20px 0; }
        .coin { width: 220px; cursor: pointer; filter: drop-shadow(0 0 15px #14F195); transition: 0.1s; }
        .coin:active { transform: scale(0.9); }
        .status { font-size: 12px; color: #444; margin-top: 20px; }
    </style>
</head>
<body>

    <div id="loading">Connecting to Omlla Network...</div>

    <div id="game" style="display:none;">
        <div style="letter-spacing: 3px; font-size: 12px;">OMLLA CAPITAL</div>
        <div class="balance" id="points">0.00</div>
        
        <img src="https://img.icons8.com/emoji/256/turtle-emoji.png" class="coin" id="clicker">
        
        <div style="margin-top:20px;">
            <span>Energy: </span><span id="energy">1000</span>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

       
      const firebaseConfig = {
    databaseURL: "https://omlla-game-default-rtdb.firebaseio.com"
};

        
        // Initialize Firebase with Error Catching
        try {
            firebase.initializeApp(firebaseConfig);
            const db = firebase.database();
            
            const user = tg.initDataUnsafe.user || { id: "test_user", first_name: "Player" };
            const userRef = db.ref('players/' + user.id);

            let points = 0;
            let energy = 1000;

            // Load Data
            userRef.on('value', (snapshot) => {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('game').style.display = 'block';
                const data = snapshot.val();
                if(data) {
                    points = data.points || 0;
                    document.getElementById('points').innerText = points.toLocaleString();
                }
            });

            // Click Logic
            document.getElementById('clicker').onclick = () => {
                if(energy > 0) {
                    points += 1;
                    energy -= 1;
                    document.getElementById('points').innerText = points.toLocaleString();
                    document.getElementById('energy').innerText = energy;
                    
                    // Satisfies Rules: newData.hasChildren(['points', 'name'])
                    userRef.set({
                        points: points,
                        name: user.first_name || "Player"
                    });
                }
            };
        } catch (e) {
            document.getElementById('loading').innerText = "Connection Error: " + e.message;
        }
    </script>
</body>
</html>




