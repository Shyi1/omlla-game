<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>OMLLA | SOVEREIGN WEALTH & RANKINGS</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@800&family=Plus+Jakarta+Sans:wght@300;500;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --gold: #E5C100; --accent: #00F0FF; --bg-deep: #020202;
            --surface: rgba(15, 15, 15, 0.95);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; user-select: none; }
        body { background: var(--bg-deep); color: #fff; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        .executive-header { padding: 20px 20px 10px; background: linear-gradient(to bottom, rgba(229,193,0,0.05), transparent); border-bottom: 1px solid rgba(255,255,255,0.03); }
        .network-bar { display: flex; justify-content: space-between; font-size: 8px; font-weight: 800; letter-spacing: 2px; color: var(--gold); opacity: 0.7; }

        .ledger-card { background: var(--surface); border: 1px solid rgba(229,193,0,0.2); border-radius: 28px; padding: 25px 20px; text-align: center; box-shadow: 0 15px 35px rgba(0,0,0,0.8); margin-top: 10px; }
        .balance-main { font-size: 42px; font-weight: 800; letter-spacing: -1px; font-style: italic; }

        .page { display: none; height: 100%; overflow-y: auto; padding: 20px 20px 150px; }
        .page.active { display: block; }

        /* أسلوب القوائم */
        .executive-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05); border-radius: 20px; padding: 15px; margin-bottom: 12px; }
        .btn-gold { background: var(--gold); color: #000; border: none; padding: 14px; border-radius: 12px; font-weight: 800; width: 100%; cursor: pointer; }

        /* التصميم الخاص بـ Leaderboard */
        .rank-item { display: flex; align-items: center; justify-content: space-between; padding: 12px 15px; background: rgba(255,255,255,0.02); border-radius: 15px; margin-bottom: 8px; border: 1px solid rgba(255,255,255,0.03); }
        .rank-number { width: 25px; font-weight: 900; color: var(--gold); font-size: 12px; }
        .rank-name { flex: 1; margin-left: 10px; font-weight: 600; font-size: 13px; }
        .rank-val { font-weight: 800; color: #fff; font-size: 12px; }
        .my-rank { border: 1px solid var(--gold); background: rgba(229,193,0,0.05); }

        /* التعدين */
        .vault-core { flex: 1; display: flex; align-items: center; justify-content: center; min-height: 250px; }
        .omlla-sovereign { width: 200px; height: 200px; border-radius: 50%; background: radial-gradient(circle at 35% 35%, #FFEC8B 0%, #E5C100 45%, #856404 100%); box-shadow: 0 30px 60px rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; cursor: pointer; border: 5px solid #1a1503; }
        .omlla-sovereign:active { transform: scale(0.95); }

        /* التنقل السفلي */
        .nav-bar { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 92%; background: rgba(10,10,10,0.98); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); border-radius: 30px; display: flex; padding: 8px; z-index: 1000; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
        .nav-item { flex: 1; text-align: center; color: #444; font-size: 8px; font-weight: 800; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 8px 0; border-radius: 20px; transition: 0.3s; }
        .nav-item.active { color: var(--gold); background: rgba(255,215,0,0.05); }
        .nav-item i { font-size: 18px; }

        .liquidity-track { height: 4px; background: #000; border-radius: 10px; overflow: hidden; margin: 10px 0; }
        .liquidity-fill { height: 100%; background: var(--gold); transition: width 0.3s; }
    </style>
</head>
<body>

<header class="executive-header">
    <div class="network-bar">
        <span>OMLLA_NETWORK • RANKING_NODE</span>
        <span id="sol-price">SOL: $81.54</span>
    </div>
    <div class="ledger-card">
        <div class="balance-main" id="bal">0.00</div>
        <div style="font-size: 9px; font-weight: 600; color: var(--accent); letter-spacing: 1px;">GLOBAL EQUITY POSITION</div>
    </div>
</header>

<main style="flex: 1; position: relative;">
    
    <section id="page-mine" class="page active">
        <div class="vault-core">
            <div class="omlla-sovereign" id="action-btn"></div>
        </div>
        <div style="display:flex; justify-content:space-between; font-size:9px; font-weight:800; color:#555;">
            <span>RESERVE LIQUIDITY</span>
            <span id="energy-txt">1000/1000</span>
        </div>
        <div class="liquidity-track"><div class="liquidity-fill" id="energy-fill" style="width: 100%;"></div></div>
    </section>

    <section id="page-rank" class="page">
        <h2 style="color:var(--gold); margin-bottom:20px; font-style:italic;">GLOBAL_LEADERBOARD</h2>
        <div id="leaderboard-list">
            <p style="text-align:center; color:#444; font-size:12px;">Syncing Global Ranks...</p>
        </div>
    </section>

    <section id="page-boost" class="page">
        <h2 style="color:var(--gold); margin-bottom:20px;">UPGRADES</h2>
        <div class="executive-card">
            <p style="font-weight:800;">Multi-Tap Engine</p>
            <p style="font-size:10px; color:#888; margin-bottom:10px;">+1.0 Per Tap</p>
            <button class="btn-gold" onclick="buyUpgrade('tap')">Cost: 5,000 Omlla</button>
        </div>
    </section>

    <section id="page-friends" class="page">
        <h2 style="color:var(--gold); margin-bottom:20px;">NETWORK</h2>
        <div class="executive-card" style="text-align:center;">
            <p style="font-weight:800; margin-bottom:15px;">Your Referral Link</p>
            <button class="btn-gold" onclick="shareRef()">INVITE PARTNERS</button>
        </div>
    </section>

</main>

<nav class="nav-bar">
    <div class="nav-item active" onclick="showPage('mine', this)"><i class="fas fa-hammer"></i>MINE</div>
    <div class="nav-item" onclick="showPage('rank', this); loadLeaderboard();"><i class="fas fa-trophy"></i>RANKS</div>
    <div class="nav-item" onclick="showPage('boost', this)"><i class="fas fa-rocket"></i>BOOST</div>
    <div class="nav-item" onclick="showPage('friends', this)"><i class="fas fa-users"></i>FRIENDS</div>
</nav>

<script>
    const tg = window.Telegram.WebApp;
    // Firebase Config
    const firebaseConfig = { databaseURL: "https://omllagame-default-rtdb.europe-west1.firebasedatabase.app/" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    
    const user = tg.initDataUnsafe?.user || { id: "dev_user", first_name: "Executive_User" };
    const userRef = db.ref('players/' + user.id);

    let state = { bal: 0, energy: 1000, maxEnergy: 1000, tapValue: 1.5, cloudRate: 0.25, price: 0.0052, name: user.first_name };

    userRef.on('value', (snap) => {
        if(snap.val()) { state = {...state, ...snap.val()}; updateUI(); }
        else { userRef.set(state); }
    });

    function updateUI() {
        document.getElementById('bal').innerText = state.bal.toLocaleString(undefined, {minimumFractionDigits: 2});
        document.getElementById('energy-txt').innerText = Math.floor(state.energy) + "/" + state.maxEnergy;
        document.getElementById('energy-fill').style.width = (state.energy / state.maxEnergy * 100) + "%";
    }

    function showPage(id, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById('page-' + id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        el.classList.add('active');
        tg.HapticFeedback.impactOccurred('light');
    }

    // Leaderboard Logic
    function loadLeaderboard() {
        const listDiv = document.getElementById('leaderboard-list');
        db.ref('players').orderByChild('bal').limitToLast(10).once('value', (snap) => {
            let html = '';
            let players = [];
            snap.forEach(child => { players.push(child.val()); });
            players.reverse().forEach((p, index) => {
                const isMe = p.name === state.name ? 'my-rank' : '';
                html += `
                    <div class="rank-item ${isMe}">
                        <span class="rank-number">#${index + 1}</span>
                        <span class="rank-name">${p.name || 'Anonymous'}</span>
                        <span class="rank-val">${Math.floor(p.bal).toLocaleString()} O$</span>
                    </div>
                `;
            });
            listDiv.innerHTML = html;
        });
    }

    document.getElementById('action-btn').addEventListener('touchstart', (e) => {
        e.preventDefault();
        if(state.energy < 1) return;
        state.bal += state.tapValue;
        state.energy -= 1;
        updateUI();
        tg.HapticFeedback.impactOccurred('heavy');
    });

    function buyUpgrade(type) {
        if(state.bal >= 5000) {
            state.bal -= 5000; state.tapValue += 1;
            userRef.update(state);
            tg.showAlert("Upgrade Confirmed.");
        }
    }

    function shareRef() {
        const link = "https://t.me/YourBotName?start=ref" + user.id;
        tg.openTelegramLink("https://t.me/share/url?url=" + encodeURIComponent(link));
    }

    setInterval(() => {
        state.bal += state.cloudRate;
        if(state.energy < state.maxEnergy) state.energy += 3;
        updateUI();
        if(Math.floor(state.bal) % 20 === 0) userRef.update(state);
    }, 1000);

    tg.expand();
</script>
</body>
</html>
